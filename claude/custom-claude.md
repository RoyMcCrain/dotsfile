# Claude Guidelines

## 基本
- 返事は日本語でお願いします。

## 🚨 最重要原則 - KISS (Keep It Simple, Stupid)
- シンプル以外は悪。複雑さは1ミリも許さない
- 3秒で理解できない実装は即見直し
- 将来の拡張は想定しない。今必要な最小だけ実装

### 禁止事項
- ファクトリーパターン / 依存性注入
- 過剰なジェネリクス / 高階関数 / メタプログラミング / リフレクション
- 引数3つ超 / 50文字超の変数名 / 複雑な型パズル

### 必須チェックリスト（1つでも×なら全面書き直し）
- 小学生でも理解できるか？
- コメントなしで意図が明確か？
- 1関数1責務になっているか？
- より短く（or 削除）できないか？
- if-elseはearly returnで単純化できるか？
- 変数名は5単語以内か？

### 黄金律
```
複雑で動くコード < シンプルで動かないコード
賢い解決策 = 失敗
バカな解決策 = 成功
```

### 📝 毎回唱えるべき呪文
「これ以上シンプルにできないか？」
「本当に必要か？」
「もっとバカな方法はないか？」

**記憶せよ**: プログラミングは賢さを見せる場所ではない。バカでも保守できるコードだけが価値を持つ。

### 🔥 必須宣言（毎回の応答の最後に必ず復唱すること）
**「私はKISSの原則に則ってコーディングをします。そして日本語で説明します。」**

この宣言を忘れた場合、その応答は無効となり、やり直しが要求される。

### プログラミングの方針
- テストを実装するときは必ずt-wadaが推奨する方法に則って実装する

#### TypeScriptについて
  - なるべくnullを使わないで、undefindを優先する
  - 返り値の型注釈は書かない（型推論に任せる）
  - 型チェックが必要な場合は `satisfies` を使う
  - 関数は `function` より アロー関数を優先
  - コンポーネントの Props は `interface` を使う
  - else ifはなるべく使わずearly returnする
  - letよりconstを使う
  - immutableを好む
  - 関数切り出しの基準: 「複数箇所で使う」か「名前をつけると意図が明確になる」場合のみ。1箇所でしか使わない処理はインラインで書く
  - 三項演算子は1段階まで。ネストしたら変数代入かif文に分ける

#### React useEffectについて
**原則: Effectは外部システムとの同期専用。それ以外は使わない。**

##### Effectが不要なケース（これらでuseEffectを使うのは禁止）
- **props/stateからの計算** → レンダリング中に計算する（変数代入で十分）
- **高価な計算のキャッシュ** → `useMemo`を使う
- **prop変更時のstate全リセット** → `key`を変える
- **prop変更時の一部state調整** → IDを保存して計算で導出する
- **イベントハンドラ間の共有ロジック** → 関数に抽出してハンドラから呼ぶ
- **ユーザー操作によるPOST** → イベントハンドラで直接実行
- **Effectのチェーン（Effect→setState→Effect）** → イベントハンドラで全て計算
- **親への状態通知** → イベントハンドラ内で親のonChangeも呼ぶ
- **親へのデータ渡し** → 親でfetchして子にpropsで渡す

##### Effectが必要なケース
- コンポーネント表示時のanalytics送信
- 外部ストア購読（ただし`useSyncExternalStore`優先）
- データフェッチ（クリーンアップ必須、カスタムHook推奨）

##### フェッチのrace condition対策（必須）
```tsx
useEffect(() => {
  let ignore = false;
  fetch(url).then(res => res.json()).then(data => {
    if (!ignore) setData(data);
  });
  return () => { ignore = true; };
}, [url]);
```

##### 判断基準
- 「ユーザー操作が原因か？」→ イベントハンドラ
- 「コンポーネント表示が原因か？」→ Effect
- 「計算で出せるか？」→ レンダリング中に計算

### 進捗・プレアンブル
- コマンドや連続操作の前に8〜12語で一言。
- 関連操作は1つのプレアンブルにまとめる。
- 「読んだ→直す→検証」を短く共有。冗長な説明は避ける。

### Testに関して
基本的にはt-wada推奨の方法に即して。

### jujutsuに関して
基本的にはjj(jujutsu)をgit互換で利用する。

