# Neovim キーマップ完全ガイド

このドキュメントはNeovimのカスタムキーマップとプラグインのキーバインドをまとめたものです。
配列: astarte配列用に最適化

## 目次
1. [基本操作](#基本操作)
2. [ウィンドウ操作](#ウィンドウ操作)
3. [モード別キーマップ](#モード別キーマップ)
4. [プラグイン](#プラグイン)
5. [カスタムコマンド](#カスタムコマンド)
6. [ワークフロー例](#ワークフロー例)

---

## 基本操作

### エディタ基本操作
| キー | 説明 | モード |
|------|------|--------|
| Y | 現在のカーソル位置から行末までヤンク | Normal |
| NN | 検索ハイライトをクリア | Normal |
| <Leader>r | 画面の再描画（redraw!） | Normal |
| O | 現在の行の下に新しい行を挿入してインサートモード | Normal |
| j | w の代替（astarte配列用）| Normal/Visual |
| W | テキストの折り返しを有効化 (wrap) | Normal |
| WW | テキストの折り返しを無効化 (nowrap) | Normal |
| zR | すべての折りたたみを展開 | Normal |

### ナビゲーション
| キー | 説明 | モード |
|------|------|--------|
| C-o | 前のジャンプ位置に戻る（LSP定義ジャンプから戻る時に便利） | Normal |
| C-i | 次のジャンプ位置に進む | Normal |

---

## ウィンドウ操作

### ウィンドウ分割
| キー | 説明 | モード |
|------|------|--------|
| vs | 垂直分割 (:vsplit) | Normal |
| S | 水平分割 (:split) | Normal |

### ウィンドウ間移動
| キー | 説明 | モード |
|------|------|--------|
| C-k | 左のウィンドウへ移動 | Normal |
| C-t | 上のウィンドウへ移動 | Normal |
| C-n | 下のウィンドウへ移動 | Normal |
| C-s | 右のウィンドウへ移動 | Normal |
| C-l | 右側ターミナル（通常）をトグル | Normal/Terminal |

---

## モード別キーマップ

### Normal モード
基本操作、ウィンドウ操作、プラグイン操作のほとんどが利用可能

### Visual モード
| キー | 説明 |
|------|------|
| C-j | 矩形選択（C-vの代替、貼り付けと競合回避） |
| gcc | 選択範囲を一行コメント化 |
| gbc | 選択範囲をブロックコメント化 |
| s | hop.nvim: 2文字ジャンプ |
| t + [方向] | hop.nvim: 方向指定ジャンプ |

### Insert モード
| キー | 説明 |
|------|------|
| C-t | Tailwind CSS補完を表示 |
| C-n | 補完候補を選択（次の候補） |
| C-p | 補完候補を選択（前の候補） |
| C-k | 補完を確定 |
| C-e | 補完をキャンセル |

---

## プラグイン

### ClaudeCode - AI支援
| キー | 説明 | モード |
|------|------|--------|
| <Leader>q | Claude Codeとの対話を開始 | Normal/Visual |
| <Leader>Q | 現在のファイルをコンテキストにしてClaude Codeと対話 | Normal |

### Comment.nvim - コメント操作
| キー | 説明 | モード |
|------|------|--------|
| gcc | 現在の行をコメントトグル | Normal |
| gbc | 現在の行をブロックコメントトグル | Normal |
| gc | 選択範囲を一行コメント | Visual |
| gb | 選択範囲をブロックコメント | Visual |
| gcA | 行末にコメントを追加 | Normal |
| gco | 下にコメント行を追加 | Normal |
| gcO | 上にコメント行を追加 | Normal |

### vim-fugitive - Git操作
プレフィックス: `<Leader>g` → `【git】`

| キー | 説明 | コマンド |
|------|------|----------|
| 【git】s | Gitステータス表示・ステージング | :Git |
| 【git】c | コミット | :Git commit |
| 【git】p | プッシュ | :Git push |
| 【git】l | ログ表示 | :Git log |
| 【git】d | 差分表示 | :Gdiff |
| 【git】a | ファイルを追加 | :Git add |
| 【git】m | マージ | :Git merge |
| 【git】b | 現在行のblame表示 | :Git blame |

### hop.nvim - 高速カーソル移動
| キー | 説明 | モード |
|------|------|--------|
| s | 画面内の2文字で位置を指定してジャンプ | Normal/Visual |
| t | 方向指定プレフィックス | Normal/Visual |
| tk | 左方向へジャンプ | Normal/Visual |
| tt | 上方向へジャンプ | Normal/Visual |
| tn | 下方向へジャンプ | Normal/Visual |
| ts | 右方向へジャンプ | Normal/Visual |
| tl | 単語の先頭へジャンプ | Normal/Visual |

### nvim-lsp - Language Server Protocol
| キー | 説明 | モード |
|------|------|--------|
| H | カーソル下のシンボルの型情報を表示（ホバー） | Normal |

プレフィックス: `l` → `【LSP】`

| キー | 説明 | 機能 |
|------|------|------|
| 【LSP】a | コードアクション（修正候補）| 利用可能なアクションを表示 |
| 【LSP】D | 定義へジャンプ | 関数やクラスの定義元へ |
| 【LSP】T | 型定義へジャンプ | 型の定義元へ |
| 【LSP】r | 参照箇所一覧 | シンボルが使用されている箇所を表示 |
| 【LSP】R | リネーム | プロジェクト全体でシンボル名を変更 |
| 【LSP】w | ワークスペースシンボル検索 | プロジェクト全体から検索 |
| 【LSP】I | 実装へジャンプ | インターフェースの実装先へ |
| 【LSP】d | ドキュメントシンボル | 現在のファイル内のシンボル一覧 |
| 【LSP】l | 診断情報一覧 | エラー・警告の一覧表示 |
| 【LSP】k | 前の診断へ | 前のエラー・警告へ移動 |
| 【LSP】s | 次の診断へ | 次のエラー・警告へ移動 |

### vsnip - スニペット
| キー | 説明 | モード |
|------|------|--------|
| Tab | スニペット展開/次のプレースホルダーへ | Insert/Select |
| S-Tab | 前のプレースホルダーへ | Insert/Select |
| C-j | ジャンプ（スニペット内での移動） | Insert/Select |

### Fern - ファイルエクスプローラー
| キー | 説明 | モード |
|------|------|--------|
| <Leader>l | Fernを全画面で開く | Normal |
| <Leader>m | Fernを垂直分割で開く | Normal |

#### Fern内での操作
| キー | 説明 |
|------|------|
| Enter | ファイル/ディレクトリを開く |
| V | 垂直分割で開く |
| S | 水平分割で開く |
| D | 削除 |
| l | リロード（表示更新） |
| N | 新規ファイル作成 |
| K | 新規ディレクトリ作成 |
| c | コピー |
| m | 移動 |
| R | リネーム |
| h | 親ディレクトリへ |
| - | マーク切り替え |

### ddu.vim - ファジーファインダー
プレフィックス: `k` → `【ddu】`

| キー | 説明 | 検索対象 |
|------|------|----------|
| 【ddu】g | Grep検索 | ファイル内容を正規表現で検索 |
| 【ddu】k | ファイル検索 | ファイル名でファジー検索 |
| 【ddu】b | バッファ検索 | 開いているバッファから検索 |
| 【ddu】m | 履歴検索 | 最近開いたファイルから検索 |
| 【ddu】r | レジスタ検索 | レジスタの内容を検索 |
| 【ddu】w | カーソル下の単語で検索 | 現在の単語でGrep |

#### ddu内での操作
| キー | 説明 |
|------|------|
| Enter | 選択して開く |
| v | 垂直分割で開く |
| s | 水平分割で開く |
| i | フィルタモードへ |
| p | プレビュー表示切り替え |
| Esc | キャンセル |
| Space | アイテムを選択/選択解除 |
| * | すべてを選択 |

### ddc.vim - 自動補完
Insert モードで自動的に動作

| キー | 説明 |
|------|------|
| C-n | 次の補完候補を選択 |
| C-p | 前の補完候補を選択 |
| C-k | 選択中の候補で確定 |
| C-e | 補完をキャンセル |
| Tab | スニペット展開/次の位置へ |
| C-t | Tailwind CSS専用補完を起動 |

#### 補完ソース優先順位
1. vsnip - スニペット補完
2. LSP - Language Server Protocol補完
3. file - ファイルパス補完
4. around - カーソル周辺の単語補完

### vim-abolish - ケース変換
caseコマンド: `cr` + 変換タイプ

| キー | 説明 | 例 |
|------|------|-----|
| crc | camelCaseに変換 | someVariable |
| crs | snake_caseに変換 | some_variable |
| crm | MixedCase(PascalCase)に変換 | SomeVariable |
| cru | UPPER_CASEに変換 | SOME_VARIABLE |
| cr- | kebab-caseに変換 | some-variable |
| cr. | dot.caseに変換 | some.variable |

### render-markdown.nvim - Markdown表示拡張
| キー | 説明 | モード |
|------|------|--------|
| <Leader>rm | Markdownレンダリング切り替え | Normal |

#### 自動レンダリング
- Markdownファイル（.md）を開くと自動的にレンダリング有効
- コードブロック、テーブル、リスト、見出しが視覚的に表示
- リンクとインラインコードがハイライト表示

### vim-surround - 囲み文字操作
凡例: `【e】` = 既存の囲み文字, `【d】` = 目的の囲み文字

| キー | 説明 | 例 |
|------|------|-----|
| ds【e】 | 囲みを削除 | ds" → "hello" → hello |
| cs【e】【d】 | 囲みを変更 | cs"' → "hello" → 'hello' |
| ys【motion】【d】 | 囲みを追加 | ysiw" → hello → "hello" |
| yss【d】 | 行全体を囲む | yss{ → hello → { hello } |
| S【d】 | Visual選択を囲む | 選択してS" → 選択部分を"で囲む |

囲み文字の種類:
- `"` `'` `` ` `` - 引用符
- `(` `)` or `b` - 括弧（スペースなし）
- `{` `}` or `B` - 中括弧（スペースあり）
- `[` `]` - 角括弧
- `<` `>` or `t` - HTMLタグ
- `w` - 単語
- `W` - WORD
- `s` - 文
- `p` - 段落

---

## テキストオブジェクト

### 標準テキストオブジェクト
| オブジェクト | 説明 | 例 |
|------------|------|-----|
| iw / aw | 単語（inner/around） | diw で単語削除 |
| is / as | 文（inner/around） | dis で文削除 |
| ip / ap | 段落（inner/around） | dip で段落削除 |
| i" / a" | ダブルクォート内/含む | di" で引用符内削除 |
| i' / a' | シングルクォート内/含む | da' で引用符含め削除 |
| i` / a` | バッククォート内/含む | ci` でバッククォート内変更 |
| i( / a( | 括弧内/含む | vi( で括弧内選択 |
| i{ / a{ | 中括弧内/含む | ca{ で中括弧含め変更 |
| i[ / a[ | 角括弧内/含む | di⟨ で角括弧内削除 |
| it / at | HTMLタグ内/含む | dit でタグ内削除 |

### カスタムテキストオブジェクト（プラグイン拡張）
| オブジェクト | 説明 | プラグイン |
|------------|------|----------|
| ii / ai | インデントレベル | vim-indent-object |
| if / af | 関数内/含む | 言語別プラグイン |
| ic / ac | クラス内/含む | 言語別プラグイン |

---

## カスタムコマンド

| コマンド | 説明 |
|---------|------|
| :Doc | ドキュメントを新しいタブで開く |
| :LspDebugClients | LSPクライアントのデバッグ情報を表示 |
| :LspRestart | LSPサーバーを再起動 |
| :LspInfo | LSP情報を表示 |
| :Format | コードフォーマット実行 |
| :ClaudeCode | Claude Codeセッション開始 |
| :Messages | Vimメッセージ履歴表示 |
| :checkhealth | Neovimヘルスチェック |

---

## ワークフロー例

### 1. コードナビゲーション例
```
1. 【LSP】D で定義へジャンプ
2. 編集を行う
3. C-o で元の位置に戻る
4. 【LSP】r で他の参照箇所を確認
```

### 2. リファクタリング例
```
1. 【LSP】r で使用箇所を確認
2. 【LSP】R でシンボル名を変更
3. 【ddu】g で残っている箇所がないか確認
4. 【git】d で変更内容を確認
5. 【git】s でステージング
6. 【git】c でコミット
```

### 3. ファイル検索と編集
```
1. 【ddu】k でファイル検索
2. i でフィルタ入力
3. Enter で開く
4. vs で隣に別ファイルを開く
5. C-k/C-s でウィンドウ間移動
```

### 4. デバッグワークフロー
```
1. 【LSP】l でエラー一覧を確認
2. 【LSP】s で次のエラーへ移動
3. H でエラー詳細を確認
4. 【LSP】a でクイックフィックス適用
5. 【ddu】b でバッファ間を移動しながら修正
```

### 5. Git操作フロー
```
1. 【git】s でステータス確認
2. = で差分表示（fugitive内）
3. s でステージング（fugitive内）
4. 【git】c でコミット
5. コミットメッセージ入力
6. 【git】p でプッシュ
```

### 6. 高速編集テクニック
```
1. s + 2文字 で目的位置へジャンプ（hop）
2. ysiw" で単語を引用符で囲む（surround）
3. crs でsnake_caseに変換（abolish）
4. gcc でコメントアウト（comment）
5. . で直前の操作を繰り返し
```

---

## Tips & トラブルシューティング

### よくある問題と解決方法

1. **補完が効かない場合**
   - `:LspInfo` でLSPの状態を確認
   - `:LspRestart` でLSPを再起動

2. **キーマップが効かない場合**
   - `:verbose map <キー>` で現在のマッピングを確認
   - 他のプラグインとの競合を確認

3. **Fernが開かない場合**
   - プラグインが正しくロードされているか確認
   - `:checkhealth` で依存関係を確認

### パフォーマンス最適化

- 大きなファイルでは `WW` (nowrap) で折り返しを無効化
- 不要なLSPは設定で無効化
- dduの検索は対象を絞って使用

### カスタマイズのヒント

- Leader キーは Space に設定（変更可能）
- astarte配列用の設定は init.lua で調整可能
- プラグイン設定は nvim/plugins/ ディレクトリで管理
- dpp.vim設定は TypeScript で記述（nvim/dpp/）

### よく使うコマンドライン

| コマンド | 説明 |
|---------|------|
| :w | ファイル保存 |
| :q | 終了 |
| :wq | 保存して終了 |
| :e 【file】 | ファイルを開く |
| :sp 【file】 | 水平分割で開く |
| :vsp 【file】 | 垂直分割で開く |
| :tabnew 【file】 | 新しいタブで開く |
| :bn / :bp | 次/前のバッファへ |
| :bd | バッファを閉じる |
| :%s/old/new/g | 全体置換 |
| :noh | 検索ハイライト解除 |

---

## クイックリファレンス

### 頻出キーコンボ
| 操作 | キー | 説明 |
|------|------|------|
| 定義ジャンプ | 【LSP】D | カーソル下のシンボルの定義へ |
| 型情報表示 | H | ホバー情報（型・ドキュメント） |
| ファイル検索 | 【ddu】k | ファジーファインダーでファイル検索 |
| Grep検索 | 【ddu】g | プロジェクト全体から文字列検索 |
| Gitステータス | 【git】s | 変更ファイル一覧とステージング |
| コメント切替 | gcc | 現在行のコメント/アンコメント |
| 2文字ジャンプ | s | hop.nvimで高速移動 |
| エラー表示 | 【LSP】l | 診断情報（エラー・警告）一覧 |
| リネーム | 【LSP】R | プロジェクト全体でシンボル名変更 |
| ファイラー | <Leader>l | Fernを全画面で開く |

### モード切り替え
| 操作 | キー | 説明 |
|------|------|------|
| Normal → Insert | i | カーソル位置で挿入 |
| Normal → Insert | a | カーソル後で挿入 |
| Normal → Insert | o | 下に新行で挿入 |
| Normal → Insert | O | 上に新行で挿入 |
| Normal → Visual | v | 文字選択モード |
| Normal → Visual Line | V | 行選択モード |
| Normal → Visual Block | C-j | 矩形選択モード |
| Any → Normal | Esc | Normalモードへ |
| Insert → Normal | C-[ | Normalモードへ |

---

## レジスタ操作

### 特殊レジスタ
| レジスタ | 説明 | 使用例 |
|---------|------|--------|
| " | デフォルトレジスタ | ""p で貼り付け |
| 0 | 直前のヤンク内容 | "0p でヤンク内容貼り付け |
| 1-9 | 削除履歴（1が最新） | "1p で直前の削除を貼り付け |
| + | システムクリップボード | "+y でコピー、"+p で貼り付け |
| * | 選択クリップボード（Linux） | "*y でコピー |
| / | 直前の検索パターン | "/p で検索パターン貼り付け |
| : | 直前のコマンド | ":p でコマンド貼り付け |
| . | 直前の挿入テキスト | ".p で直前入力を貼り付け |
| % | 現在のファイル名 | "%p でファイル名貼り付け |
| # | 代替ファイル名 | "#p で代替ファイル名貼り付け |

### レジスタ操作コマンド
| コマンド | 説明 |
|---------|------|
| :reg | 全レジスタ内容表示 |
| :reg a b c | 指定レジスタ内容表示 |
| "ay | aレジスタにヤンク |
| "ap | aレジスタから貼り付け |
| "Ay | aレジスタに追記ヤンク |
| 【ddu】r | dduでレジスタ検索 |

---

## マクロ操作

### マクロ記録と実行
| 操作 | キー | 説明 |
|------|------|------|
| 記録開始 | qa | aレジスタにマクロ記録開始 |
| 記録停止 | q | マクロ記録停止 |
| 実行 | @a | aレジスタのマクロ実行 |
| 繰り返し | @@ | 直前のマクロ再実行 |
| 複数回実行 | 10@a | aレジスタのマクロを10回実行 |
| Visual実行 | :normal @a | 選択行でマクロ実行 |

### マクロ編集テクニック
1. "ap でマクロ内容を貼り付け
2. 編集
3. "ayy で編集内容をaレジスタに保存

---

## 折りたたみ（Fold）操作

| キー | 説明 |
|------|------|
| za | 折りたたみ切り替え |
| zo | 折りたたみを開く |
| zc | 折りたたみを閉じる |
| zR | すべて展開 |
| zM | すべて折りたたむ |
| zj | 次の折りたたみへ |
| zk | 前の折りたたみへ |

---

更新日: 2025-08-15
Neovim バージョン: 0.10以上推奨
